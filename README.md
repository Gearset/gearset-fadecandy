# Gearset fadecandy
Software for powering an org test status lightboard using a fadecandy board and a raspberry pi.

## Requirements
- npm
- node 8.x

## Setup

- Download [fadecandy](https://github.com/scanlime/fadecandy/releases) and extract the executable for your operating system into this folder
- `npm install`
- Set up a `config.json` file (see below)
- Run `npm run start-windows` for windows
- Run `npm run start-rpi` for raspberry pi
- Run `npm run start-osx` for OSX

### Raspberry Pi

You may need to add a new udev rule to allow non-admin access to the USB fadecandy device. In the `/etc/udev/rules.d/10-local.rules` file (create it if it doesn't exist), add:

```
# udev rules file for the Scanlime Fadecandy device
SUBSYSTEM=="usb|usb_device", ACTION=="add", ATTRS{idVendor}=="1d50", ATTRS{idProduct}=="607a", GROUP="plugdev"
```

Note that you still may encounter problems if plugging the USB device in _after_ starting the fadecandy server.

## config.json

Configuration settings are pulled from a `config.json` file in the root directory. It should have the following properties:

- `feedUrl`: the URL of the cc.xml file you would like to monitor
- `projectUrls`: an array of the web URLs of the projects you want to display using the fadecandy board (since the feed may contain more projects than you have lights)

#### Example
```json
{
    "feedUrl": "https://app.gearset.com/api/test-monitor-notification-feeds/00000000-0000-0000-0000-000000000000/cc.xml",
    "projectUrls": [
        "https://app.gearset.com/test-monitoring-runs?monitorId=00000000-0000-0000-0000-000000000000",
        "https://app.gearset.com/test-monitoring-runs?monitorId=11111111-1111-1111-1111-111111111111",
        "https://app.gearset.com/test-monitoring-runs?monitorId=22222222-2222-2222-2222-222222222222",
        "https://app.gearset.com/test-monitoring-runs?monitorId=33333333-3333-3333-3333-333333333333"
    ]
}
```

## Outputs

The output formats are configured using `model.json` and `fcserver.json`, and are currently configured to output 5 statuses using the first 45 pixels on outputs 0, 1, 6, 7 and 3 of the fadecandy board.

The first four statuses are assigned to `orgs`, the last one (output 3) is for the `logo`.

The `model.json` file can be generated by running `model-generator.js`, and defines a set of pixels for each org to display. These pixels are output, contiguously and in order, to fadecandy.

The `fcserver.json` file maps the pixels output as defined in `model.json` to fadecandy board outputs, along with a few other configuration options such as the LED whitepoint. More information on this file's format is available in the fadecandy documentation.
